<html>
<head>
  <title>San Francisco Elementary Schools</title>
  <meta charset="utf-8">
 
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
  <script src="jquery-2.1.1.min.js"></script>

  <style>
      #map { width: 90%; height: 80%; }
      .info { padding: 6px 8px; font: 150% Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; width:250px; word-wrap:break-word;word-wrap: break-word;} 
      .info h4 { margin: 0 0 5px; color: #777; }
      .info h3 { margin: 0 0 5px; color: #777; }
      p { font-size: 80%;}
      .legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
      
  </style>
  </head>
  <body>
  <div align="center">
    <h3 id="Map Title"> San Francisco Elementary Schools 2015-2016</h3>
  </div>
  <div align="center">
  <div id="map" align=""></div>
  </div>

  <script>

  // initialize the map
  //var map = L.map('map').setView([42.35, -71.08], 13); //Boston
/* var southWest = L.latLng(37.6982268,-122.5239693,
    northEast = L.latLng(37.8203137,-122.3841439),
    bounds = L.latLngBounds(southWest, northEast);
    */


var map = L.map('map').setView([37.774, -122.435], 13);

L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);
/*
L.marker([37.740924,-122.4126154]).addTo(map)
    .bindPopup('Casa Banks.<br> So good.')
    .openPopup();
*/
   

  // set bounds, not currently doing anything
  var southWest = L.latLng(37.7081596,-122.3616664),
    northEast = L.latLng(37.7888013,-122.5185603),
    bounds = L.latLngBounds(southWest, northEast);
  

// add our data control
  var info = L.control();

  info.onAdd = function (map) {
      this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
      this.update();
      return this._div;
  };

  // method that we will use to update the control based on feature properties passed
  info.update = function (props) {
      var immersion = '&nbsp';
      if (props) { 
        if (props.Total > 5) {
          immersion = 'Total Kindergarten applicants: '+props.Total;
        }
        if (props.CHN > 5) {
          immersion = immersion + '</b><br />Cantonese Biliteracy applicants: '+props.CHN; 
        }
        if (props.FIL > 5) {
          immersion = immersion + '</b><br />Filipino Biliteracy applicants: '+props.FIL; 
        }
        if (props.JPN > 5) {
          immersion = immersion + '</b><br />Japanese Biliteracy applicants: '+props.JPN; 
        }
        if (props.SPN > 5) {
          immersion = immersion + '</b><br />Spanish Biliteracy applicants: '+props.SPN; 
        }
        if (props.IMMS > 5) {
          immersion = immersion + '</b><br />Spanish Immersion applicants: '+props.IMMS; 
        }        
        if (props.IMMC > 5) {
          immersion = immersion + '</b><br />Cantonese Immersion applicants: '+props.IMMC; 
        }
        if (props.IMMK > 5) {
          immersion = immersion + '</b><br />Korean Immersion applicants: '+props.IMMK; 
        }
        if (props.IMMM > 5) {
          immersion = immersion + '</b><br />Mandarin Immersion applicants: '+props.IMMM; 
        }
      }
      else { immersion= '&nbsp';}
      var acceptanceChance = '&nbsp';
      if (props) {
        if (props.KAdmitted >= props.RequestsFirst) { 
          acceptanceChance = '</b><br />Easy to get in ' + '<p>' + props.RequestsFirst + ' 1st pick applications, </b><br />'
          + props.KAdmitted + ' Kindergarteners accepted. ';
        }
        else {
          var chanceMath =   100 * parseInt(props.KAdmitted)/ parseInt(props.RequestsFirst) ;
          acceptanceChance = '</b><br />Hard to get in (' + chanceMath.toFixed(1) + '%)'
          + '<p>' + props.RequestsFirst + ' 1st pick applications, </b><br />'
          + props.KAdmitted + ' Kindergarteners accepted. ';
        }
      }
      this._div.innerHTML = (props ?
          '<b>' + props.school_name 
          + '</b><br />' + props.grades
          + '</b><br />' + 'Score: ' + props.score +' out of 10' 
          + acceptanceChance 
          + '<p>' + immersion 
          + '</b><br />' + '<p>' + props.math_percent + '% pass CAASPP Math ' +'&nbsp'+'&nbsp'+'&nbsp'
          + '</b><br />' + props.eng_percent + '% pass CAASPP English' + '<p>'
         
          : 'Hover over a school');
  };

info.shortUpdate = function (props) {
      var immersion = '&nbsp';
      if (props) { 
        if (props.Total > 5) {
          immersion = 'Total Kindergarten applicants: '+props.Total;
        }
        if (props.CHN > 5) {
          immersion = immersion + '</b><br />Cantonese Biliteracy applicants: '+props.CHN; 
        }
        if (props.FIL > 5) {
          immersion = immersion + '</b><br />Filipino Biliteracy applicants: '+props.FIL; 
        }
        if (props.JPN > 5) {
          immersion = immersion + '</b><br />Japanese Biliteracy applicants: '+props.JPN; 
        }
        if (props.SPN > 5) {
          immersion = immersion + '</b><br />Spanish Biliteracy applicants: '+props.SPN; 
        }
        if (props.IMMS > 5) {
          immersion = immersion + '</b><br />Spanish Immersion applicants: '+props.IMMS; 
        }        
        if (props.IMMC > 5) {
          immersion = immersion + '</b><br />Cantonese Immersion applicants: '+props.IMMC; 
        }
        if (props.IMMK > 5) {
          immersion = immersion + '</b><br />Korean Immersion applicants: '+props.IMMK; 
        }
        if (props.IMMM > 5) {
          immersion = immersion + '</b><br />Mandarin Immersion applicants: '+props.IMMM; 
        }
      }
      else { immersion= '&nbsp';}
      var acceptanceChance = '&nbsp';
      if (props) {
        if (props.KAdmitted >= props.RequestsFirst) { 
          acceptanceChance = '</b><br />Easy to get in ' ;
        }
        else {
          var chanceMath =   100 * parseInt(props.KAdmitted)/ parseInt(props.RequestsFirst) ;
          acceptanceChance = '</b><br />Hard to get in';
        }
      }
      this._div.innerHTML = (props ?
          '<b>' + props.school_name 
          
          + '</b><br />' + 'Score: ' + props.score +' out of 10' 
          + '</b><br />' + acceptanceChance
          + '</b><br /></b><br /> click school for more info'
         
         
          : 'Hover over a school');
  };

info.addTo(map);

function getColor(d) {
    return d > 9 ? '#004529' :
           d > 8 ? '#006837' :
           d > 7  ? '#238443' :
           d > 6  ? '#41ab5d' :
           d > 5  ? '#78c679' :
           d > 4  ? '#addd8e' :
           d > 3  ? '#d9f0a3' :
           d > 2  ? '#f7fcb9' :
                    '#ffffe5';
}
  // load GeoJSON from an external file

$.getJSON("schoolsWithEnrollment.geojson",function(data){
   
    L.geoJson(data,{
      pointToLayer: function(feature,latlng){
        var circleSize = (feature.properties.score / 1.5) + 8 ;
        
        var marker = L.circleMarker(latlng,{ radius: circleSize, color: 'green', opacity: 1, fillColor: getColor(feature.properties.score), fillOpacity: 0.75});
        /*  code from when we had school urls
        marker.bindPopup('<a href="http://www.sfusd.edu/en/' + feature.properties.school_url +'">'
          + feature.properties.school_name
          +'</a>'+ '<br/> score: ' + feature.properties.score1);
          */
        /*marker.bindPopup('Percent of student who passed <br> Math: '+feature.properties.math_percent 
          +'% <br> English: ' +feature.properties.eng_percent+'%'); */
        marker.on('mouseover', function(e){
            info.shortUpdate(feature.properties);
            marker.setStyle({ color: 'black', fillOpacity: 1});
        });
        marker.on('click', function(e){
            info.update(feature.properties);
        });
        marker.on('mouseout', function(){
          marker.setStyle({ color: 'green', fillOpacity: 0.75});
        });

        return marker;
      }
    }).addTo(map);
  });



</script>
<div id="TestInfo"> 
    <p class="mbm" >
      <span class="open-sans_sb">About the test</span>     
    </p>

  <div>
    <p>In 2015-2016, California tested students using the California Assessment of Student Performance and Progress (CAASPP), administered through the online Smarter Balanced Summative Assessments. These are comprehensive, end-of-year assessments of grade-level learning that measure progress toward college and career readiness. Each test, English language arts/literacy (ELA) and mathematics is comprised of two parts: (1) a computer adaptive test and (2) a performance task; administered within a 12-week window beginning at 66 percent of the instructional year for grades three through eight, or within in a 7-week window beginning at 80 percent of the instructional year for grade eleven. The summative assessments are aligned with the Common Core State Standards (CCSS) for ELA and mathematics. The tests capitalize on the strengths of computer adaptive testing-efficient and precise measurement across the full range of achievement and timely turnaround of results.
    </p>
  </div>
  <div class="testSource">
          <p class="font-size-small ptm">Source: <a href="http://www.cde.ca.gov/nr/ne/yr16/yr16rel57.asp#Table1">CA Dept. of Education</a></p>
  </div> 
</div>
</body>
</html>